.version 9.0
.target sm_70
.address_size 64

// addition (tree based reduction)
// Level 0 (input):   1   2   3   4   5   6   7   8
//                     \_+_/     \_+_/     \_+_/     \_+_/
// Level 1 (s=4):        6        10        —         —      (stored at indices 0,1,2,3)
//                        \__+__/            \__+__/
// Level 2 (s=2):           16                 —             (stored at indices 0,1)
//                            \______+______/
// Level 3 (s=1):                  36                        (stored at index 0)
.visible .entry sum(
    .param .u64 a,
	.param .u64 sum,
	.param .u32 n
) {
    .reg .u64 rd_a, rd_sum;
    .reg .u32 total_size;
    .reg .u32 ctaid, ntid, tid, idx;
    .reg .u32 s, offset;
    .reg .f32 val1, val2, sum_val;
    .reg .u64 addr_a, ptr1, ptr2;

    ld.param.u64 	rd_a, [a];
    ld.param.u64 	rd_sum, [sum];
    ld.param.u32 	total_size, [n];

    mov.u32 	ctaid, %ctaid.x;
    mov.u32 	ntid, %ntid.x;
    mov.u32 	tid, %tid.x;
    mad.lo.u32 	idx, ctaid, ntid, tid;

    setp.ge.u32 	p1, idx, total_size;
    @p1 bra 	$END_SUM;

    cvta.to.global.u64 	addr_a, rd_a;

    mov.u32 s, 1;

$END_SUM:
    ret;
}